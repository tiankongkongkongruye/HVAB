## 问题定位
- 运行使用 `--mode hybrid` 但融合权重为固定 `gate=mean(L)`，对 Retinex 输出依赖过高且不随内容自适应，导致整体偏暗与指标早停。
- GLC 端映射为简单 `1×1`，表达力不足；CM‑FSC 目标为线性 `V_map` 简化，频率约束较弱。

## 代码改造（保持论文逻辑）
1) 学习式门控融合（替代 `mean(L)`）
- 在 `net.forward` 用 GLC‑Former 的 `alpha` 与亮度 `L` 生成像素级门控：
  - `alpha_map = σ(Conv1x1([L, reshape(alpha→map), feat_to_img]))`，尺寸与图像一致
  - 输出：`I = alpha_map ⊙ I_phy + (1−alpha_map) ⊙ J_img`
- 保留 `--mode full/hybrid/den_phy/cm fsc`；仅融合路径更新为可学习门控。

2) 强化 GLC 输出头（保持轻量）
- 将 `feat_to_img` 从 `1×1` 升级为小解码器：`Conv(16→32)→ReLU→Conv(32→16)→ReLU→Conv(16→3)→Sigmoid`，增强细节与亮度表达。

3) CM‑FSC 目标改进（贴近论文）
- 用 `T_j(e_j)` 生成 `F_j^clip`：`Linear(embedding→C_j)` 后 reshape/broadcast 到特征图，替代当前 `V_map` 简化；频率损失改为 `∑||F̂_j−F_j^clip||²`。

4) Full 模式启用逆 CRF
- 在 `--mode full` 下使用 `I = κ^{-1}(J_img)`；`hybrid` 使用上面的学习式门控融合。

## 调参策略（分阶段）
- 阶段 A（1–20）：`λ_F=0, λ_C=0, λ_exp=0.4, λ_color=0.1, λ_spa=0.2, tv=0.05, lr=5e-6`
- 阶段 B（21–60）：`λ_F=0.1, λ_C=0.05`；`--clip_text "low light image" "well-lit image"`
- 阶段 C（61+）：`λ_F=0.2, λ_C=0.1`；裁剪提升到 `256`（显存允许）
- 增加 `--exp_mean`（默认 0.6）以控制曝光目标；若偏暗则提高至 `0.7`。

## 验证与预期
- 保存 `results/val_I/` 进行快照对比；指标：
  - SSIM：由 0.49→0.55+（一致性与门控作用）
  - LPIPS：由 0.81→下降（0.75~0.70）
  - PSNR：小幅提升或持平（以视觉质量为主）

## 交付
- 修改文件：`net/lformer_Net.py`（门控融合、GLC 输出头、CM‑FSC 目标），`utils_Net.py`（频率损失目标处理），`main_Net.py`（分阶段调度与 `exp_mean` 参数）。
- 保留现有 CLI 与模式，新增 `--exp_mean`；默认行为不破坏当前用法。